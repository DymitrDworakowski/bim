"use strict";(self.webpackChunkbim=self.webpackChunkbim||[]).push([[387],{387:(t,e,s)=>{s.r(e),s.d(e,{default:()=>E});var a,i,n,o,r,l=s(555),c=s(248),d=s(532),u=s(43),h=s(790),p=s(149),m=s(458),b=s(562),g=s(558),v=s(239),A=s(454),x=s(329),y=s(723),f=(a=new WeakMap,i=new WeakMap,n=new WeakMap,o=new WeakMap,r=new WeakSet,class extends x.Q{constructor(t,e){super(),(0,h.A)(this,r),(0,p.A)(this,a,void 0),(0,p.A)(this,i,void 0),(0,p.A)(this,n,void 0),(0,p.A)(this,o,void 0),(0,g.A)(a,this,t),this.setOptions(e),this.bindMethods(),(0,b.A)(r,this,j).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var e;const s=this.options;this.options=(0,m.A)(a,this).defaultMutationOptions(t),(0,y.f8)(this.options,s)||(0,m.A)(a,this).getMutationCache().notify({type:"observerOptionsUpdated",mutation:(0,m.A)(n,this),observer:this}),null!==s&&void 0!==s&&s.mutationKey&&this.options.mutationKey&&(0,y.EN)(s.mutationKey)!==(0,y.EN)(this.options.mutationKey)?this.reset():"pending"===(null===(e=(0,m.A)(n,this))||void 0===e?void 0:e.state.status)&&(0,m.A)(n,this).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(null===(t=(0,m.A)(n,this))||void 0===t||t.removeObserver(this))}onMutationUpdate(t){(0,b.A)(r,this,j).call(this),(0,b.A)(r,this,w).call(this,t)}getCurrentResult(){return(0,m.A)(i,this)}reset(){var t;null===(t=(0,m.A)(n,this))||void 0===t||t.removeObserver(this),(0,g.A)(n,this,void 0),(0,b.A)(r,this,j).call(this),(0,b.A)(r,this,w).call(this)}mutate(t,e){var s;return(0,g.A)(o,this,e),null===(s=(0,m.A)(n,this))||void 0===s||s.removeObserver(this),(0,g.A)(n,this,(0,m.A)(a,this).getMutationCache().build((0,m.A)(a,this),this.options)),(0,m.A)(n,this).addObserver(this),(0,m.A)(n,this).execute(t)}});function j(){var t,e;const s=null!==(t=null===(e=(0,m.A)(n,this))||void 0===e?void 0:e.state)&&void 0!==t?t:(0,v.$)();(0,g.A)(i,this,(0,l.A)((0,l.A)({},s),{},{isPending:"pending"===s.status,isSuccess:"success"===s.status,isError:"error"===s.status,isIdle:"idle"===s.status,mutate:this.mutate,reset:this.reset}))}function w(t){A.jG.batch(()=>{if((0,m.A)(o,this)&&this.hasListeners()){const u=(0,m.A)(i,this).variables,h=(0,m.A)(i,this).context;var e,s,a,n;if("success"===(null===t||void 0===t?void 0:t.type))null===(e=(s=(0,m.A)(o,this)).onSuccess)||void 0===e||e.call(s,t.data,u,h),null===(a=(n=(0,m.A)(o,this)).onSettled)||void 0===a||a.call(n,t.data,null,u,h);else if("error"===(null===t||void 0===t?void 0:t.type)){var r,l,c,d;null===(r=(l=(0,m.A)(o,this)).onError)||void 0===r||r.call(l,t.error,u,h),null===(c=(d=(0,m.A)(o,this)).onSettled)||void 0===c||c.call(d,void 0,t.error,u,h)}}this.listeners.forEach(t=>{t((0,m.A)(i,this))})})}function N(t,e){const s=(0,c.jE)(e),[a]=u.useState(()=>new f(s,t));u.useEffect(()=>{a.setOptions(t)},[a,t]);const i=u.useSyncExternalStore(u.useCallback(t=>a.subscribe(A.jG.batchCalls(t)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),n=u.useCallback((t,e)=>{a.mutate(t,e).catch(y.lQ)},[a]);if(i.error&&(0,y.GU)(a.options.throwOnError,[i.error]))throw i.error;return(0,l.A)((0,l.A)({},i),{},{mutate:n,mutateAsync:i.mutate})}var k=s(576),C=s(924),S=s(579);const E=function(){const t=(0,k.Zp)(),e=(0,c.jE)(),s=localStorage.getItem("token"),{data:a,isLoading:i,error:n}=(0,d.I)({queryKey:["blogs"],queryFn:C.gb}),[o,r]=(0,u.useState)({title:"",content:""}),h=N({mutationFn:t=>(0,C.$5)(t,s),onSuccess:()=>{e.invalidateQueries(["blogs"]),r({title:"",content:""})}}),p=N({mutationFn:t=>(0,C.cc)(t,s),onSuccess:()=>e.invalidateQueries(["blogs"])}),[m,b]=(0,u.useState)(null),g=N({mutationFn:t=>{let{id:e,data:a}=t;return(0,C.c5)({id:e,data:a,token:s})},onSuccess:()=>{e.invalidateQueries(["blogs"]),b(null)}});return i?(0,S.jsx)("p",{children:"Loading..."}):n?(0,S.jsxs)("p",{children:["Error: ",n.message]}):(0,S.jsxs)("div",{className:"p-6 bg-gray-100 min-h-screen",children:[(0,S.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"\ud83d\udcd1 Pane\u0142 zarz\u0105dzania blogiem"}),(0,S.jsxs)("form",{onSubmit:t=>{t.preventDefault(),h.mutate(o)},className:"flex flex-col gap-2 bg-white p-4 rounded shadow-md mb-6",children:[(0,S.jsx)("input",{type:"text",placeholder:"Nazwa",value:o.title,onChange:t=>r((0,l.A)((0,l.A)({},o),{},{title:t.target.value})),className:"border p-2 rounded",required:!0}),(0,S.jsx)("textarea",{placeholder:"Napisz tu kontent",value:o.content,onChange:t=>r((0,l.A)((0,l.A)({},o),{},{content:t.target.value})),className:"border p-2 rounded",required:!0}),(0,S.jsx)("button",{type:"submit",className:"bg-green-600 text-white py-2 rounded hover:bg-green-700",children:"Dodaj blog"})]}),(0,S.jsx)("div",{className:"space-y-4",children:a.map(t=>(0,S.jsx)("div",{className:"bg-white p-4 rounded shadow-md flex flex-col gap-2",children:m===t._id?(0,S.jsxs)("form",{onSubmit:e=>{e.preventDefault(),g.mutate({id:t._id,data:{title:o.title,content:o.content}})},className:"flex flex-col gap-2",children:[(0,S.jsx)("input",{type:"text",defaultValue:t.title,onChange:t=>r((0,l.A)((0,l.A)({},o),{},{title:t.target.value})),className:"border p-2 rounded"}),(0,S.jsx)("textarea",{defaultValue:t.content,onChange:t=>r((0,l.A)((0,l.A)({},o),{},{content:t.target.value})),className:"border p-2 rounded"}),(0,S.jsxs)("div",{className:"flex gap-2",children:[(0,S.jsx)("button",{type:"submit",className:"bg-blue-600 text-white py-1 px-3 rounded hover:bg-blue-700",children:"Zapisa\u0107"}),(0,S.jsx)("button",{type:"button",onClick:()=>b(null),className:"bg-gray-400 text-white py-1 px-3 rounded hover:bg-gray-500",children:"Cofn\u0105\u0107"})]})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("h2",{className:"text-lg font-semibold",children:t.title}),(0,S.jsx)("p",{children:t.content}),(0,S.jsxs)("small",{children:["Autor: ",t.author||"Admin"]}),(0,S.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,S.jsx)("button",{onClick:()=>b(t._id),className:"bg-yellow-500 text-white py-1 px-3 rounded hover:bg-yellow-600",children:"Edytuj"}),(0,S.jsx)("button",{onClick:()=>p.mutate(t._id),className:"bg-red-600 text-white py-1 px-3 rounded hover:bg-red-700",children:"Usu\u0144"})]})]})},t._id))}),(0,S.jsx)("div",{className:"flex justify-center",children:(0,S.jsx)("button",{className:"bg-red-800 text-white py-1 px-3 rounded hover:bg-red-700 m-4 ",onClick:async()=>{try{s&&await(0,C.ri)(s),t("/")}catch(e){console.error("Logout failed:",e)}},children:"Wyloguj si\u0119"})})]})}},924:(t,e,s)=>{s.d(e,{$5:()=>r,c5:()=>l,cc:()=>c,gb:()=>o,iD:()=>i,ri:()=>n});const a=s(722).A.create({baseURL:"https://bim-rest-api.onrender.com/api"}),i=async t=>{try{const{data:e}=await a.post("/auth/login",{name:t.name,email:t.email,password:t.password});return e.token&&localStorage.setItem("token",e.token),e}catch(s){var e;throw console.error("Login failed:",(null===(e=s.response)||void 0===e?void 0:e.data)||s.message),s}},n=async t=>{await a.post("/auth/logout",{},{headers:{Authorization:"Bearer ".concat(t)}}),localStorage.removeItem("token")},o=async()=>{const{data:t}=await a.get("/blog");return t},r=async(t,e)=>{let{title:s,content:i}=t;console.log(s,i);const n=await a.post("/blog",{title:s,content:i},{headers:{Authorization:"Bearer ".concat(e)}});return console.log(n.data),n.data},l=async t=>{let{id:e,data:s,token:i}=t;return(await a.put("/blog/".concat(e),s,{headers:{Authorization:"Bearer ".concat(i)}})).data},c=async(t,e)=>(await a.delete("/blog/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}})).data}}]);
//# sourceMappingURL=387.d6773eb2.chunk.js.map